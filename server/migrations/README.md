# Database Migrations

This directory contains SQL migration files that define the database schema for Voxa.

## Running Migrations

Migrations are automatically run when the server starts (if `DATABASE_URL` is configured).

You can also run migrations manually:

```bash
npm run migrate
```

## Migration Files

- `001_initial_schema.sql` - Creates initial tables: `meetings`, `tts_messages`, `user_settings`

## Migration Tracking

Migrations are tracked in the `schema_migrations` table, which is automatically created on first run. Each migration file is executed only once.

## Creating New Migrations

1. Create a new SQL file with a sequential number: `002_description.sql`
2. Write your SQL statements (CREATE TABLE, ALTER TABLE, etc.)
3. Run `npm run migrate` to apply the migration

## Database Schema

### Tables

#### `meetings`
Stores meeting information and metadata.
- Links to users via `user_id` (Supabase auth.users)
- Tracks meeting status: scheduled, active, completed, cancelled
- Stores platform, URL, duration, and timestamps

#### `tts_messages`
Stores all text-to-speech messages generated by users.
- Links to users via `user_id`
- Optionally links to meetings via `meeting_id`
- Tracks voice settings, text content, and status

#### `user_settings`
Stores user preferences for TTS and application settings.
- One row per user
- Stores default voice, speed, pitch, and language preferences

## Notes

- All tables use UUID primary keys
- Timestamps use `TIMESTAMPTZ` (timezone-aware)
- Foreign keys reference Supabase `auth.users(id)` (not enforced by database, handled by application)
- Indexes are created for common query patterns
